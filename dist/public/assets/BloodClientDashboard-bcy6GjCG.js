import{j as e,u as Me,cg as Ae,r as o,b4 as je,B as H,ch as Le,bz as qe,aj as Fe,bL as Ue,aZ as He,bT as Re,bP as Ie,bQ as Oe,b3 as $e,bU as _e}from"./vendor-C1l_5e97.js";import{B as Ke}from"./BloodHeader-B0vauP4R.js";import{u as Ne,B as ze}from"./BloodThemeContext-E2xwPxg0.js";import{B as J}from"./button-DpFebx5z.js";import{C as q}from"./card-CFv6635F.js";import{I as m}from"./input-Ci_LweTY.js";import"./badge-wSxm0MMJ.js";import"./index-Cv9frRJP.js";function Qe({children:l}){const{theme:r}=Ne();return e.jsxs("div",{className:"blood-uh min-h-screen relative overflow-hidden",style:{backgroundColor:r.background,color:r.textPrimary,"--blood-bg":r.background,"--blood-surface":r.surface,"--blood-surface-muted":r.surfaceMuted,"--blood-surface-elevated":r.surfaceElevated,"--blood-text-primary":r.textPrimary,"--blood-text-secondary":r.textSecondary,"--blood-text-tertiary":r.textTertiary,"--blood-border-subtle":r.borderSubtle,"--blood-border-default":r.borderDefault,"--blood-border-strong":r.borderStrong,"--blood-primary":r.primaryBlue,"--blood-grid":r.grid},children:[e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{background:"radial-gradient(circle at 50% 0%, rgba(2,121,232,0.14) 0%, transparent 60%)"}}),e.jsx("div",{className:"pointer-events-none absolute inset-0 opacity-35",style:{backgroundImage:`linear-gradient(to right, ${r.grid} 1px, transparent 1px), linear-gradient(to bottom, ${r.grid} 1px, transparent 1px)`,backgroundSize:"60px 60px"}}),e.jsx("div",{className:"relative",children:l})]})}const ve=async l=>{const r=localStorage.getItem("apexlabs_token"),g=await fetch(l,{headers:r?{Authorization:`Bearer ${r}`}:void 0});if(!g.ok)throw new Error(`HTTP ${g.status}`);return g.json()},Je=l=>l==null?"Aucun score pour l'instant":l>=90?"Exceptionnel":l>=80?"Tres bon":l>=70?"Correct":l>=60?"A optimiser":"Prioritaire",Ve={hidden:{opacity:0,y:12},show:{opacity:1,y:0,transition:{staggerChildren:.08,duration:.4,ease:"easeOut"}}},V={hidden:{opacity:0,y:12},show:{opacity:1,y:0,transition:{duration:.35,ease:"easeOut"}}};function Ge(){var ge,ye;const[,l]=Me(),{theme:r,mode:g}=Ne(),G=Ae(),[d,Z]=o.useState(0),[F,R]=o.useState(null),[P,I]=o.useState(!1),[W,X]=o.useState(!1),[O,Y]=o.useState(null),[$,x]=o.useState(null),[b,_]=o.useState(""),[h,ee]=o.useState(""),[y,se]=o.useState(""),[re,te]=o.useState("homme"),[j,ae]=o.useState(""),[v,Ce]=o.useState(""),[N,Se]=o.useState(""),[C,oe]=o.useState(""),[S,le]=o.useState(""),[w,ne]=o.useState(""),[D,ie]=o.useState(""),[k,de]=o.useState(""),[T,ce]=o.useState(""),[E,me]=o.useState(""),[B,K]=o.useState([]),[M,ue]=o.useState(""),[A,xe]=o.useState(""),we=[{id:"creatine",label:"Creatine"},{id:"biotine",label:"Biotine"},{id:"vitamine_d",label:"Vitamine D"},{id:"omega_3",label:"Omega-3"},{id:"nac",label:"NAC"},{id:"magnesium",label:"Magnesium"},{id:"zinc",label:"Zinc"}],De=s=>{K(a=>a.includes(s)?a.filter(i=>i!==s):[...a,s])},L=o.useMemo(()=>({backgroundColor:r.surface,borderColor:r.borderDefault,color:r.textSecondary}),[r]),pe=o.useMemo(()=>{const s=Number(v),a=Number(N);if(!s||!a)return null;const i=s/Math.pow(a/100,2);return Number.isFinite(i)?i:null},[v,N]),ke=s=>({color:{completed:r.status.optimal,processing:r.status.suboptimal,failed:r.status.critical,error:r.status.critical}[s]||r.textSecondary,borderColor:r.borderDefault,backgroundColor:g==="dark"?"rgba(255,255,255,0.06)":r.surfaceMuted});o.useEffect(()=>{localStorage.getItem("apexlabs_token")||l("/auth/login?next=/blood-dashboard")},[l]);const{data:n,error:be}=je({queryKey:["/api/me"],queryFn:()=>ve("/api/me"),retry:!1});o.useEffect(()=>{n!=null&&n.user&&Z(n.user.credits??0)},[n]),o.useEffect(()=>{be&&l("/auth/login?next=/blood-dashboard")},[be,l]),o.useEffect(()=>{var s;(s=n==null?void 0:n.user)!=null&&s.email&&!b&&_(n.user.email)},[(ge=n==null?void 0:n.user)==null?void 0:ge.email,b]);const{data:U,error:he}=je({queryKey:["/api/blood-tests"],queryFn:()=>ve("/api/blood-tests"),refetchInterval:s=>{var c;const a=s.state.data;return((c=a==null?void 0:a.bloodTests)==null?void 0:c.some(Q=>Q.status==="processing"))?5e3:!1}});o.useEffect(()=>{he&&x("Impossible de charger l'historique.")},[he]);const f=o.useMemo(()=>((U==null?void 0:U.bloodTests)||[]).slice().sort((s,a)=>new Date(a.uploadedAt).getTime()-new Date(s.uploadedAt).getTime()),[U]),u=o.useMemo(()=>f.filter(s=>s.status==="completed"&&s.globalScore!==null),[f]),p=u[0],t=(p==null?void 0:p.patient)||null;o.useEffect(()=>{t!=null&&t.prenom&&!h&&ee(t.prenom),t!=null&&t.nom&&!y&&se(t.nom),t!=null&&t.dob&&!j&&ae(t.dob),t!=null&&t.gender&&(t.gender==="homme"||t.gender==="femme")&&te(t.gender),t!=null&&t.email&&!b&&_(t.email),t!=null&&t.sleepHours&&!C&&oe(String(t.sleepHours)),t!=null&&t.stressLevel&&!S&&le(String(t.stressLevel)),t!=null&&t.fastingHours&&!w&&ne(String(t.fastingHours)),t!=null&&t.drawTime&&!D&&ie(t.drawTime),t!=null&&t.lastTraining&&!k&&de(t.lastTraining),t!=null&&t.alcoholLast72h&&!T&&ce(t.alcoholLast72h),t!=null&&t.nutritionPhase&&!E&&me(t.nutritionPhase),t!=null&&t.medications&&!M&&ue(t.medications),t!=null&&t.infectionRecent&&!A&&xe(t.infectionRecent),!B.length&&(t!=null&&t.supplementsUsed)&&(Array.isArray(t.supplementsUsed)?K(t.supplementsUsed):typeof t.supplementsUsed=="string"&&K(t.supplementsUsed.split(",").map(s=>s.trim()).filter(Boolean)))},[t,h,y,j,b,C,S,w,D,k,T,E,M,A,B.length]);const fe=o.useMemo(()=>{const s=f.length,a=u.map(c=>c.globalScore||0),i=a.length?Math.round(a.reduce((c,Q)=>c+Q,0)/a.length):0;return{total:s,avg:i}},[f,u]),Te=h||(t==null?void 0:t.prenom)||((ye=n==null?void 0:n.user)!=null&&ye.email?n.user.email.split("@")[0]:""),Ee=o.useMemo(()=>u.slice().reverse().map(s=>({date:new Date(s.uploadedAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}),score:s.globalScore||0})),[u]),Be=async()=>{if(!F){x("Ajoute un PDF.");return}if(d<=0){x("Plus aucun credit disponible.");return}if(!b.trim()){x("Email requis.");return}if(!h.trim()||!y.trim()||!j){x("Prenom, nom et date de naissance requis.");return}if(!v.trim()||!N.trim()){x("Poids et taille requis.");return}x(null),Y(null),X(!0);try{const s=localStorage.getItem("apexlabs_token"),a=new FormData;a.append("file",F),a.append("email",b.trim()),a.append("prenom",h),a.append("nom",y),a.append("gender",re),a.append("dob",j),a.append("poids",v),a.append("taille",N),C&&a.append("sleepHours",C),S&&a.append("stressLevel",S),w&&a.append("fastingHours",w),D&&a.append("drawTime",D),k&&a.append("lastTraining",k),T&&a.append("alcoholLast72h",T),E&&a.append("nutritionPhase",E),B.length&&a.append("supplementsUsed",JSON.stringify(B)),M.trim()&&a.append("medications",M.trim()),A&&a.append("infectionRecent",A);const i=await fetch("/api/blood-tests/upload",{method:"POST",headers:s?{Authorization:`Bearer ${s}`}:void 0,body:a}),c=await i.json();if(!i.ok)throw new Error((c==null?void 0:c.error)||"Erreur upload.");Z(c.remainingCredits??d),Y("Analyse lancee. Le rapport apparaitra dans l'historique."),R(null),await G.invalidateQueries({queryKey:["/api/blood-tests"]})}catch(s){x(s instanceof Error?s.message:"Erreur upload.")}finally{X(!1)}},z=u.length>=2?u[0].globalScore-u[1].globalScore:null;return e.jsxs(Qe,{children:[e.jsx(Ke,{credits:d}),e.jsxs(H.main,{variants:Ve,initial:"hidden",animate:"show",className:"mx-auto max-w-6xl px-6 py-10",children:[e.jsxs(H.section,{variants:V,className:"flex flex-col gap-6 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] blood-text-tertiary",children:"Blood Analysis"}),e.jsxs("h1",{className:"mt-3 blood-h1 blood-text-primary",children:["Bonjour ",Te,"."]}),e.jsx("p",{className:"mt-3 max-w-2xl blood-text-secondary leading-relaxed blood-body",children:"Je decode ton bilan sanguin ligne par ligne. Tu obtiens une lecture clinique + performance, des signaux prioritaires, et un plan d'action clair."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(q,{className:"border px-4 py-3",style:{backgroundColor:r.surface,borderColor:r.borderDefault},children:[e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Credits restants"}),e.jsx("p",{className:"text-2xl font-semibold blood-text-primary",children:d})]}),e.jsx(J,{className:"text-white font-semibold hover:opacity-90",style:{backgroundColor:r.primaryBlue},onClick:()=>l("/offers/blood-analysis"),children:"Acheter des credits"})]})]}),e.jsxs(H.section,{variants:V,className:"mt-10 grid gap-6 lg:grid-cols-3",children:[e.jsxs(q,{className:"border p-6 lg:col-span-2",style:{backgroundColor:r.surface,borderColor:r.borderDefault},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold tracking-tight blood-text-primary",children:"Uploader un bilan sanguin"}),e.jsx("p",{className:"mt-1 text-sm blood-text-secondary",children:"PDF uniquement · 10 MB max · 1 credit par analyse"})]}),e.jsx("span",{className:"rounded-full px-3 py-1 text-xs font-medium border",style:{borderColor:d<=0?r.status.critical:r.borderDefault,backgroundColor:d<=0?"rgba(239,68,68,0.08)":r.surfaceMuted,color:d<=0?r.status.critical:r.textSecondary},children:d<=0?"Credits requis":"Disponible"})]}),e.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Prenom"}),e.jsx(m,{value:h,onChange:s=>ee(s.target.value),placeholder:"Prenom"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Nom"}),e.jsx(m,{value:y,onChange:s=>se(s.target.value),placeholder:"Nom"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Email"}),e.jsx(m,{value:b,onChange:s=>_(s.target.value),placeholder:"Email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Date de naissance"}),e.jsx(m,{type:"date",value:j,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Sexe"}),e.jsx("div",{className:"flex gap-2",children:["homme","femme"].map(s=>e.jsx("button",{type:"button",onClick:()=>te(s),className:"flex-1 rounded-lg border px-3 py-2 text-sm font-medium transition",style:re===s?{backgroundColor:r.primaryBlue,borderColor:"transparent",color:"white"}:{backgroundColor:r.surface,borderColor:r.borderDefault,color:r.textSecondary},children:s==="homme"?"Homme":"Femme"},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Poids (kg)"}),e.jsx(m,{type:"number",min:"30",max:"250",step:"0.1",value:v,onChange:s=>Ce(s.target.value),placeholder:"Ex: 78.4"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Taille (cm)"}),e.jsx(m,{type:"number",min:"140",max:"220",step:"1",value:N,onChange:s=>Se(s.target.value),placeholder:"Ex: 178"})]}),pe!==null&&e.jsx("div",{className:"rounded-lg border p-3 md:col-span-2",style:{borderColor:r.borderDefault,backgroundColor:r.surfaceMuted},children:e.jsxs("p",{className:"text-xs blood-text-secondary",children:["IMC calcule: ",e.jsx("span",{className:"font-semibold blood-text-primary",children:pe.toFixed(1)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Sommeil moyen 7 jours (h/nuit)"}),e.jsx(m,{type:"number",min:"3",max:"12",step:"0.5",value:C,onChange:s=>oe(s.target.value),placeholder:"Ex: 7.5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Stress percu (0-10)"}),e.jsx(m,{type:"number",min:"0",max:"10",step:"1",value:S,onChange:s=>le(s.target.value),placeholder:"Ex: 6"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Jeune avant prelevement (heures)"}),e.jsx(m,{type:"number",min:"0",max:"24",step:"1",value:w,onChange:s=>ne(s.target.value),placeholder:"Ex: 12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Heure du prelevement"}),e.jsxs("select",{value:D,onChange:s=>ie(s.target.value),className:"w-full rounded-lg border px-3 py-2 text-sm",style:L,children:[e.jsx("option",{value:"",children:"Selectionner"}),e.jsx("option",{value:"matin",children:"Matin (avant 10h)"}),e.jsx("option",{value:"milieu_journee",children:"Milieu de journee"}),e.jsx("option",{value:"apres_midi",children:"Apres-midi"}),e.jsx("option",{value:"soir",children:"Soir"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Dernier training intense"}),e.jsxs("select",{value:k,onChange:s=>de(s.target.value),className:"w-full rounded-lg border px-3 py-2 text-sm",style:L,children:[e.jsx("option",{value:"",children:"Selectionner"}),e.jsx("option",{value:"<24h",children:"< 24h"}),e.jsx("option",{value:"24-48h",children:"24-48h"}),e.jsx("option",{value:"48-72h",children:"48-72h"}),e.jsx("option",{value:">72h",children:"> 72h"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Alcool (72h avant)"}),e.jsxs("select",{value:T,onChange:s=>ce(s.target.value),className:"w-full rounded-lg border px-3 py-2 text-sm",style:L,children:[e.jsx("option",{value:"",children:"Selectionner"}),e.jsx("option",{value:"0",children:"0 verre"}),e.jsx("option",{value:"1-2",children:"1-2 verres"}),e.jsx("option",{value:"3-5",children:"3-5 verres"}),e.jsx("option",{value:"6+",children:"6+ verres"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Phase nutrition"}),e.jsxs("select",{value:E,onChange:s=>me(s.target.value),className:"w-full rounded-lg border px-3 py-2 text-sm",style:L,children:[e.jsx("option",{value:"",children:"Selectionner"}),e.jsx("option",{value:"seche",children:"Seche (deficit)"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"bulk",children:"Prise de masse"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Infection / inflammation recente"}),e.jsxs("select",{value:A,onChange:s=>xe(s.target.value),className:"w-full rounded-lg border px-3 py-2 text-sm",style:L,children:[e.jsx("option",{value:"",children:"Selectionner"}),e.jsx("option",{value:"non",children:"Non"}),e.jsx("option",{value:"oui",children:"Oui"})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Supplements pris recemment"}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:we.map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm blood-text-secondary",children:[e.jsx("input",{type:"checkbox",checked:B.includes(s.id),onChange:()=>De(s.id),className:"h-4 w-4 rounded border",style:{borderColor:r.borderDefault}}),s.label]},s.id))})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-xs font-medium blood-text-secondary",children:"Medicaments / hormones"}),e.jsx(m,{value:M,onChange:s=>ue(s.target.value),placeholder:"Ex: statines, TRT, metformine"})]})]}),e.jsx("div",{className:`mt-6 rounded-xl border-2 border-dashed p-6 transition ${d<=0?"opacity-60":""}`,style:{borderColor:P?r.primaryBlue:r.borderDefault,backgroundColor:P?r.surface:r.surfaceMuted},onDragEnter:s=>{s.preventDefault(),!(d<=0)&&I(!0)},onDragOver:s=>{s.preventDefault(),d<=0},onDragLeave:s=>{s.preventDefault(),I(!1)},onDrop:s=>{var i;if(s.preventDefault(),I(!1),d<=0)return;const a=((i=s.dataTransfer.files)==null?void 0:i[0])||null;a&&R(a)},children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full border",style:{backgroundColor:r.surface,borderColor:r.borderDefault},children:e.jsx(Le,{className:"h-6 w-6",style:{color:r.primaryBlue}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium blood-text-primary",children:F?F.name:"Glisse ton PDF ici, ou selectionne un fichier"}),e.jsx("p",{className:"mt-1 text-xs blood-text-tertiary",children:"PDF uniquement · 10 MB max"})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:s=>{var a;return R(((a=s.target.files)==null?void 0:a[0])||null)},disabled:d<=0,className:"text-xs blood-text-secondary file:mr-3 file:rounded-lg file:border-0 file:bg-white/10 file:px-3 file:py-2 file:blood-text-secondary hover:file:bg-white/20"})]})}),($||O)&&e.jsxs("div",{className:"mt-4",children:[$&&e.jsx("p",{className:"text-sm text-rose-600",children:$}),O&&e.jsx("p",{className:"text-sm text-emerald-700",children:O})]}),e.jsxs("div",{className:"mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs blood-text-tertiary",children:["Credit debite a l'upload. Statut: ",e.jsx("span",{className:"blood-text-secondary",children:"processing"})," →"," ",e.jsx("span",{className:"blood-text-secondary",children:"completed"}),"."]}),e.jsx(J,{disabled:W||d<=0,className:"text-white font-semibold hover:opacity-90",style:{backgroundColor:r.primaryBlue},onClick:Be,children:W?"Upload...":"Lancer l'analyse"})]})]}),e.jsxs(q,{className:"border p-6",style:{backgroundColor:r.surface,borderColor:r.borderDefault},children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold blood-text-primary",children:"Stats"}),e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Resume de tes bilans."})]}),e.jsx(qe,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs("div",{className:"mt-6 grid gap-4",children:[e.jsxs("div",{className:"rounded-lg border p-4",style:{backgroundColor:r.surfaceMuted,borderColor:r.borderDefault},children:[e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Analyses totales"}),e.jsx("p",{className:"text-2xl font-semibold blood-text-primary",children:fe.total})]}),e.jsxs("div",{className:"rounded-lg border p-4",style:{backgroundColor:r.surfaceMuted,borderColor:r.borderDefault},children:[e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Score moyen"}),e.jsx("p",{className:"text-2xl font-semibold blood-text-primary",children:fe.avg})]}),e.jsxs("div",{className:"rounded-lg border p-4",style:{backgroundColor:r.surfaceMuted,borderColor:r.borderDefault},children:[e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Dernier bilan"}),e.jsx("p",{className:"mt-1 text-sm font-medium blood-text-primary",children:p?new Date(p.uploadedAt).toLocaleDateString("fr-FR"):"Aucun"}),e.jsx("p",{className:"mt-2 text-xs blood-text-secondary",children:Je(p==null?void 0:p.globalScore)})]}),e.jsxs("div",{className:"rounded-lg border p-4",style:{backgroundColor:r.surfaceMuted,borderColor:r.borderDefault},children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold blood-text-primary",children:[e.jsx(Fe,{className:"h-4 w-4",style:{color:r.primaryBlue}}),"Focus performance"]}),e.jsx("p",{className:"mt-2 text-xs blood-text-secondary",children:"Les hormones et le metabolisme sont analyses avec un angle prise de muscle/perte de gras."})]})]})]})]}),e.jsxs(H.section,{variants:V,className:"mt-10 grid gap-6 lg:grid-cols-2",children:[e.jsxs(q,{className:"border p-5",style:{backgroundColor:r.surface,borderColor:r.borderDefault},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold blood-text-primary",children:"Historique"}),e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Ouvre un rapport complet quand le traitement est termine."})]}),e.jsx(J,{variant:"outline",className:"hover:bg-transparent",style:{borderColor:r.borderDefault,color:r.textSecondary},onClick:()=>G.invalidateQueries({queryKey:["/api/blood-tests"]}),children:"Rafraichir"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[f.length===0&&e.jsx("p",{className:"text-sm blood-text-secondary",children:"Aucun bilan pour l'instant."}),f.map(s=>{const a=s.status==="completed",i=ke(s.status);return e.jsx("button",{type:"button",disabled:!a,onClick:()=>a&&l(`/analysis/${s.id}`),className:`w-full rounded-xl border px-4 py-3 text-left transition ${a?"hover:opacity-90":"opacity-70 cursor-default"}`,style:{borderColor:r.borderDefault,backgroundColor:r.surface},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium blood-text-primary",children:s.fileName}),e.jsx("p",{className:"text-xs blood-text-tertiary",children:new Date(s.uploadedAt).toLocaleDateString("fr-FR",{dateStyle:"medium"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:"rounded-full border px-3 py-1 text-xs font-medium",style:i,children:s.status}),typeof s.globalScore=="number"&&e.jsxs("span",{className:"text-sm font-semibold blood-text-primary",children:[s.globalScore,"/100"]})]})]})},s.id)})]}),e.jsxs("div",{className:"mt-6 rounded-xl border p-4",style:{borderColor:r.borderDefault,backgroundColor:r.surface},children:[e.jsx("p",{className:"text-xs font-medium blood-text-secondary",children:"Process"}),e.jsx("ul",{className:"mt-3 space-y-2 text-xs blood-text-secondary",children:["Upload du PDF","Extraction biomarqueurs","Analyse experte + protocoles","Rapport disponible"].map(s=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-3 w-3",style:{color:r.primaryBlue}})," ",s]},s))})]})]}),e.jsxs(q,{className:"border p-5",style:{backgroundColor:r.surface,borderColor:r.borderDefault},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold blood-text-primary",children:"Tendances"}),e.jsx("p",{className:"text-xs blood-text-tertiary",children:"Evolution du score global."})]}),z!==null&&e.jsxs("p",{className:"text-sm blood-text-primary",children:[z>=0?"+":"",z," pts"]})]}),u.length>=2?e.jsx("div",{className:"h-48 mt-4",children:e.jsx(He,{width:"100%",height:"100%",children:e.jsxs(Re,{data:Ee,children:[e.jsx(Ie,{dataKey:"date",stroke:r.textTertiary}),e.jsx(Oe,{stroke:r.textTertiary,domain:[0,100]}),e.jsx($e,{contentStyle:{backgroundColor:r.surface,border:`1px solid ${r.borderDefault}`,color:r.textPrimary},labelStyle:{color:r.textPrimary}}),e.jsx(_e,{type:"monotone",dataKey:"score",stroke:r.primaryBlue,strokeWidth:2,dot:!1})]})})}):e.jsx("div",{className:"mt-4 text-sm blood-text-secondary",children:"Uploade un second bilan pour debloquer la comparaison."})]})]})]})]})}function ts(){return e.jsx(ze,{children:e.jsx(Ge,{})})}export{ts as default};
