import{r,j as e,B as P,bz as Le,aS as Ue,bA as ke,b7 as me,bB as xe,aR as ue,aT as q,bj as b,aY as Me,aV as N,b8 as De,aM as he,bb as $e,bx as z,bC as pe,bw as ee,be as je,aO as se,aG as ve,by as Fe,aU as Oe,bD as _e,b5 as te,bE as Je,bF as qe}from"./vendor-C1l_5e97.js";import{u as ze,H as Ge,F as Be}from"./index-DvBPY4Ge.js";import{B as l}from"./button-BtttnI-5.js";import{C as c,a as w,b as T,c as d}from"./card-D1XCqY91.js";import{B as u}from"./badge-CWVQ_ysa.js";import{T as Ye,a as Ve,b as L,c as U}from"./tabs-mtp00RV-.js";import{I as A}from"./input-CnXWmW4V.js";import{L as y}from"./label-DM5vx82K.js";import{T as Xe}from"./textarea-CY7trlQ4.js";const Qe=o=>o.type==="GRATUIT"?`/scan/${o.id}`:o.type==="PREMIUM"?`/anabolic/${o.id}`:o.type==="ELITE"?`/ultimate/${o.id}`:o.type==="BLOOD_ANALYSIS"?`/blood-analysis/${o.id}`:`/dashboard/${o.id}`;function ls(){const[o,G]=r.useState(()=>sessionStorage.getItem("admin_auth")==="true"),[ae,fe]=r.useState(""),[a,k]=r.useState(()=>sessionStorage.getItem("admin_key")),[ie,ne]=r.useState(!1),[S,Ne]=r.useState("relances"),[j,ye]=r.useState([]),[B,Y]=r.useState([]),[E,ge]=r.useState([]),[re,be]=r.useState([]),[x,v]=r.useState(!0),[we,M]=r.useState(!1),[He,Ke]=r.useState(null),[n,g]=r.useState({code:"",discountPercent:20,description:"",validFor:"ALL",maxUses:"",expiresAt:""}),[C,le]=r.useState(null),ce=async s=>{try{const t=await fetch("/api/admin/reviews/pending",{headers:{"x-admin-key":s}}),m=await t.json();return t.ok&&(m==null?void 0:m.success)===!0}catch{return!1}},Ae=async s=>{s.preventDefault(),ne(!1),v(!0);const t=ae.trim();t.length>0&&await ce(t)?(G(!0),sessionStorage.setItem("admin_auth","true"),sessionStorage.setItem("admin_key",t),k(t)):(ne(!0),sessionStorage.removeItem("admin_auth"),sessionStorage.removeItem("admin_key"),k(null)),v(!1)},[D,$]=r.useState(null),[Se,I]=r.useState(!1),[de,F]=r.useState(null),[V,O]=r.useState(""),[X,_]=r.useState(""),{toast:i}=ze(),J=async s=>{const t=await s.json();if(s.status===401)throw G(!1),sessionStorage.removeItem("admin_auth"),sessionStorage.removeItem("admin_key"),k(null),i({title:"Clé admin invalide",description:"Reconnecte-toi avec la bonne clé.",variant:"destructive"}),new Error("Unauthorized");if(!s.ok||!t.success)throw new Error((t==null?void 0:t.error)||"Acces admin refuse");return t};r.useEffect(()=>{!o||!a||(async()=>await ce(a)||(G(!1),sessionStorage.removeItem("admin_auth"),sessionStorage.removeItem("admin_key"),k(null),i({title:"Clé admin invalide",description:"Reconnecte-toi avec la bonne clé.",variant:"destructive"})))()},[a,o,i]);const Q=async()=>{if(a){v(!0);try{const s=await fetch("/api/admin/audits",{headers:{"x-admin-key":a}}),t=await J(s);ye(t.audits)}catch{i({title:"Erreur",description:"Impossible de charger les audits",variant:"destructive"})}finally{v(!1)}}},H=async()=>{if(a){v(!0);try{const s=await fetch("/api/admin/reviews/pending",{headers:{"x-admin-key":a}}),t=await J(s);Y(t.reviews)}catch{i({title:"Erreur",description:"Impossible de charger les avis",variant:"destructive"})}finally{v(!1)}}},K=async()=>{if(a){v(!0);try{const s=await fetch("/api/admin/incomplete-questionnaires",{headers:{"x-admin-key":a}}),t=await J(s);ge(t.questionnaires)}catch{i({title:"Erreur",description:"Impossible de charger les questionnaires incomplets",variant:"destructive"})}finally{v(!1)}}},R=async()=>{if(a){v(!0);try{const s=await fetch("/api/admin/promo-codes",{headers:{"x-admin-key":a}}),t=await J(s);be(t.codes)}catch{i({title:"Erreur",description:"Impossible de charger les codes promo",variant:"destructive"})}finally{v(!1)}}},Ee=async()=>{if(!a){i({title:"Clé admin manquante",description:"Reconnecte-toi avec la clé admin pour gérer les codes promo.",variant:"destructive"});return}if(!n.code||!n.discountPercent){i({title:"Erreur",description:"Code et réduction requis",variant:"destructive"});return}try{const t=await(await fetch("/api/admin/promo-codes",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":a},body:JSON.stringify({code:n.code.toUpperCase(),discountPercent:n.discountPercent,description:n.description||null,validFor:n.validFor,maxUses:n.maxUses?parseInt(n.maxUses):null,expiresAt:n.expiresAt||null})})).json();t.success?(i({title:"Code promo créé",description:`Le code ${n.code.toUpperCase()} a été créé`}),M(!1),g({code:"",discountPercent:20,description:"",validFor:"ALL",maxUses:"",expiresAt:""}),R()):i({title:"Erreur",description:t.error||"Impossible de créer le code promo",variant:"destructive"})}catch{i({title:"Erreur",description:"Impossible de créer le code promo",variant:"destructive"})}},Ce=async s=>{if(a)try{(await(await fetch(`/api/admin/promo-codes/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-admin-key":a},body:JSON.stringify({isActive:!s.isActive})})).json()).success&&(i({title:s.isActive?"Code désactivé":"Code activé",description:`Le code ${s.code} a été ${s.isActive?"désactivé":"activé"}`}),R())}catch{i({title:"Erreur",description:"Impossible de modifier le code promo",variant:"destructive"})}},W=async(s,t,m)=>{if(a){le(`${s}-${t}`);try{const p=await(await fetch("/api/admin/send-sequence-email",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":a},body:JSON.stringify({auditId:s,emailType:t})})).json();p.success?i({title:"Email envoyé !",description:p.message}):i({title:"Erreur",description:p.error||"Impossible d'envoyer l'email",variant:"destructive"})}catch{i({title:"Erreur",description:"Impossible d'envoyer l'email",variant:"destructive"})}finally{le(null)}}},h=s=>{if(!s)return null;const t=new Date(s);return Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24))};r.useEffect(()=>{o&&(Q(),H(),K(),R())},[o,a]),r.useEffect(()=>{o&&(S==="audits"?Q():S==="reviews"?H():S==="incomplete"?K():S==="promo"&&R())},[S,o,a]);const Te=async s=>{if(a){$(s);try{(await(await fetch(`/api/admin/reviews/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":a},body:JSON.stringify({reviewedBy:"admin"})})).json()).success&&(Y(f=>f.filter(p=>p.id!==s)),i({title:"Avis approuvé",description:"L'avis sera affiché sur le site"}))}catch{i({title:"Erreur",description:"Impossible d'approuver l'avis",variant:"destructive"})}finally{$(null)}}},Ie=async s=>{if(a){$(s);try{(await(await fetch(`/api/admin/reviews/${s}/reject`,{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":a},body:JSON.stringify({reviewedBy:"admin"})})).json()).success&&(Y(f=>f.filter(p=>p.id!==s)),i({title:"Avis rejeté",description:"L'avis ne sera pas affiché"}))}catch{i({title:"Erreur",description:"Impossible de rejeter l'avis",variant:"destructive"})}finally{$(null)}}},Re=async()=>{if(!a){i({title:"Clé admin manquante",description:"Reconnecte-toi pour envoyer un message.",variant:"destructive"});return}if(!de||!V||!X){i({title:"Erreur",description:"Veuillez remplir tous les champs",variant:"destructive"});return}try{(await(await fetch("/api/admin/send-cta",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":a||""},body:JSON.stringify({auditId:de,subject:V,message:X})})).json()).success&&(i({title:"CTA envoyé",description:"Le message a été envoyé avec succès"}),I(!1),O(""),_(""),F(null))}catch{i({title:"Erreur",description:"Impossible d'envoyer le CTA",variant:"destructive"})}},Pe=s=>e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(t=>e.jsx(ue,{className:`w-4 h-4 ${t<=s?"fill-yellow-400 text-yellow-400":"text-muted-foreground/30"}`},t))}),oe=s=>{const t={COMPLETED:"default",IN_PROGRESS:"secondary",PENDING:"outline",READY:"default",GENERATING:"secondary"};return e.jsx(u,{variant:t[s]||"outline",children:s})};return o?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Ge,{}),e.jsxs("div",{className:"container max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Dashboard Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion des audits et avis"})]}),e.jsxs(Ye,{value:S,onValueChange:Ne,children:[e.jsxs(Ve,{className:"mb-6 flex-wrap",children:[e.jsxs(L,{value:"relances",className:"gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Relances"]}),e.jsxs(L,{value:"audits",className:"gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Analyses envoyées (",j.filter(s=>s.reportDeliveryStatus==="SENT").length,")"]}),e.jsxs(L,{value:"incomplete",className:"gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Abandons (",E.length,")"]}),e.jsxs(L,{value:"reviews",className:"gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Avis (",B.length,")"]}),e.jsxs(L,{value:"promo",className:"gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Codes promo"]})]}),e.jsx(U,{value:"relances",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(xe,{className:"w-5 h-5 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Abandons questionnaire"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Relancer avec code ANALYSE20 (-20%)"})]}),e.jsx(u,{variant:"secondary",className:"ml-auto",children:E.length})]}),E.length===0?e.jsx(c,{children:e.jsx(d,{className:"py-8 text-center text-muted-foreground",children:"Aucun abandon"})}):e.jsx("div",{className:"grid gap-3",children:E.slice(0,5).map(s=>e.jsx(c,{children:e.jsxs(d,{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.email}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.percentComplete,"% complété"]})]}),e.jsxs(l,{size:"sm",onClick:()=>{F(s.id),O("Ton audit APEXLABS t'attend + Code -20% !"),_(`Salut !

J'ai vu que tu avais commencé ton questionnaire APEXLABS mais que tu ne l'as pas terminé.

Tu en étais à ${s.percentComplete}% - plus que quelques questions et tu auras accès à ton analyse personnalisée complète !

En bonus, utilise le code ANALYSE20 pour -20% sur l'analyse Anabolic !

Clique ici pour reprendre où tu en étais : ${window.location.origin}/audit-complet/questionnaire

À très vite,
Achzod`),I(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Relancer"]})]})},s.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(Me,{className:"w-5 h-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Analyses GRATUITES"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upsell Anabolic avec code ANALYSE20 (-20%)"})]}),e.jsx(u,{variant:"secondary",className:"ml-auto",children:j.filter(s=>s.type==="GRATUIT"&&s.reportDeliveryStatus==="SENT").length})]}),j.filter(s=>s.type==="GRATUIT"&&s.reportDeliveryStatus==="SENT").length===0?e.jsx(c,{children:e.jsx(d,{className:"py-8 text-center text-muted-foreground",children:"Aucune analyse gratuite"})}):e.jsx("div",{className:"grid gap-3",children:j.filter(s=>s.type==="GRATUIT"&&s.reportDeliveryStatus==="SENT").slice(0,5).map(s=>{const t=h(s.reportSentAt);return e.jsx(c,{children:e.jsxs(d,{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t!==null?`Envoyé il y a ${t} jour${t>1?"s":""}`:"Envoyé"})]}),e.jsx(l,{size:"sm",variant:"default",disabled:C===`${s.id}-GRATUIT_UPSELL`,onClick:()=>W(s.id,"GRATUIT_UPSELL"),children:C===`${s.id}-GRATUIT_UPSELL`?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Envoyer Upsell"]})})]})},s.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500/10",children:e.jsx(De,{className:"w-5 h-5 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"PREMIUM J+7"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Demande avis + CTA coaching NEUROCORE20 (-20%)"})]}),e.jsx(u,{variant:"secondary",className:"ml-auto",children:j.filter(s=>(s.type==="PREMIUM"||s.type==="ELITE")&&s.reportDeliveryStatus==="SENT"&&h(s.reportSentAt)!==null&&h(s.reportSentAt)>=7).length})]}),(()=>{const s=j.filter(t=>(t.type==="PREMIUM"||t.type==="ELITE")&&t.reportDeliveryStatus==="SENT"&&h(t.reportSentAt)!==null&&h(t.reportSentAt)>=7);return s.length===0?e.jsx(c,{children:e.jsx(d,{className:"py-8 text-center text-muted-foreground",children:"Aucun audit Anabolic/Ultimate de +7 jours"})}):e.jsx("div",{className:"grid gap-3",children:s.slice(0,5).map(t=>{const m=h(t.reportSentAt);return e.jsx(c,{children:e.jsxs(d,{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:t.type==="ELITE"?"default":"secondary",children:t.type}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.email}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),"J+",m]})]})]}),e.jsx(l,{size:"sm",variant:"default",className:"bg-purple-600 hover:bg-purple-700",disabled:C===`${t.id}-PREMIUM_J7`,onClick:()=>W(t.id,"PREMIUM_J7"),children:C===`${t.id}-PREMIUM_J7`?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"CTA J+7"]})})]})},t.id)})})})()]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:e.jsx($e,{className:"w-5 h-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"PREMIUM J+14 (Dernière chance)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Relance si J+7 non ouvert - NEUROCORE20"})]}),e.jsx(u,{variant:"secondary",className:"ml-auto",children:j.filter(s=>(s.type==="PREMIUM"||s.type==="ELITE")&&s.reportDeliveryStatus==="SENT"&&h(s.reportSentAt)!==null&&h(s.reportSentAt)>=14).length})]}),(()=>{const s=j.filter(t=>(t.type==="PREMIUM"||t.type==="ELITE")&&t.reportDeliveryStatus==="SENT"&&h(t.reportSentAt)!==null&&h(t.reportSentAt)>=14);return s.length===0?e.jsx(c,{children:e.jsx(d,{className:"py-8 text-center text-muted-foreground",children:"Aucun audit Anabolic/Ultimate de +14 jours"})}):e.jsx("div",{className:"grid gap-3",children:s.slice(0,5).map(t=>{const m=h(t.reportSentAt);return e.jsx(c,{children:e.jsxs(d,{className:"py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:t.type==="ELITE"?"default":"secondary",children:t.type}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.email}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),"J+",m]})]})]}),e.jsx(l,{size:"sm",variant:"default",className:"bg-amber-600 hover:bg-amber-700",disabled:C===`${t.id}-PREMIUM_J14`,onClick:()=>W(t.id,"PREMIUM_J14"),children:C===`${t.id}-PREMIUM_J14`?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"CTA J+14"]})})]})},t.id)})})})()]})]})}),e.jsxs(U,{value:"audits",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Analyses envoyées"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Rapports générés et envoyés aux clients"})]}),e.jsxs(l,{variant:"outline",onClick:Q,disabled:x,children:[e.jsx(z,{className:`w-4 h-4 mr-2 ${x?"animate-spin":""}`}),"Actualiser"]})]}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-primary"})}):j.length===0?e.jsx(c,{children:e.jsxs(d,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(me,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Aucun audit"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Aucun audit trouvé"})]})}):e.jsx("div",{className:"space-y-4",children:j.map((s,t)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsxs(c,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs(T,{className:"text-lg",children:["Audit ",s.id.substring(0,8),"..."]}),oe(s.status),oe(s.reportDeliveryStatus)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),s.email]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),new Date(s.createdAt).toLocaleDateString("fr-FR")]}),e.jsx(u,{variant:"outline",children:s.type})]})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{F(s.id),I(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Envoyer CTA"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"flex gap-2",children:e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>window.open(Qe(s),"_blank"),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Voir le rapport"]})})})]})},s.id))})]}),e.jsxs(U,{value:"reviews",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Modération des avis"}),e.jsxs(l,{variant:"outline",onClick:H,disabled:x,children:[e.jsx(z,{className:`w-4 h-4 mr-2 ${x?"animate-spin":""}`}),"Actualiser"]})]}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-primary"})}):B.length===0?e.jsx(c,{children:e.jsxs(d,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(se,{className:"w-12 h-12 text-primary mb-4"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Aucun avis en attente"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Tous les avis ont été modérés"})]})}):e.jsx("div",{className:"space-y-4",children:B.map((s,t)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsxs(c,{children:[e.jsx(w,{className:"pb-3",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[Pe(s.rating),e.jsxs(u,{variant:"outline",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"En attente"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Audit: ",s.auditId.substring(0,8),"... |",s.email&&` ${s.email} | `,new Date(s.createdAt).toLocaleDateString("fr-FR")]})]})})}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(Fe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsx("p",{className:"text-base",children:s.comment})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(l,{onClick:()=>Te(s.id),disabled:D===s.id,className:"flex-1",children:[D===s.id?e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(se,{className:"w-4 h-4 mr-2"}),"Approuver"]}),e.jsxs(l,{variant:"destructive",onClick:()=>Ie(s.id),disabled:D===s.id,className:"flex-1",children:[D===s.id?e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Rejeter"]})]})]})]})},s.id))})]}),e.jsxs(U,{value:"incomplete",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Questionnaires abandonnés"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Utilisateurs ayant commencé mais pas terminé le questionnaire"})]}),e.jsxs(l,{variant:"outline",onClick:K,disabled:x,children:[e.jsx(z,{className:`w-4 h-4 mr-2 ${x?"animate-spin":""}`}),"Actualiser"]})]}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-primary"})}):E.length===0?e.jsx(c,{children:e.jsxs(d,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(se,{className:"w-12 h-12 text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Aucun abandon"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Tous les utilisateurs ont terminé leur questionnaire"})]})}):e.jsx("div",{className:"space-y-4",children:E.map((s,t)=>{const m=new Date(s.lastActivityAt),f=Math.floor((Date.now()-m.getTime())/(1e3*60*60*24)),p=f<1,Z=f>7;return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsxs(c,{className:p?"border-amber-500/50":Z?"border-red-500/30":"",children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs(T,{className:"text-lg flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),s.email]}),e.jsx(u,{variant:p?"default":Z?"destructive":"secondary",children:p?"Récent":Z?"Froid":"Tiède"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),"Commencé le ",new Date(s.startedAt).toLocaleDateString("fr-FR")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Dernière activité: ",f===0?"Aujourd'hui":`il y a ${f}j`]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_e,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-2xl font-bold text-primary",children:[s.percentComplete,"%"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Section ",s.currentSection+1,"/",s.totalSections]})]})]})}),e.jsxs(d,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${s.percentComplete}%`}})})}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(l,{variant:"outline",className:"flex-1",onClick:()=>{F(s.id),O("Ton audit APEXLABS t'attend + Code -20% !"),_(`Salut !

J'ai vu que tu avais commencé ton questionnaire APEXLABS mais que tu ne l'as pas terminé.

Tu en étais à ${s.percentComplete}% - plus que quelques questions et tu auras accès à ton analyse personnalisée complète !

En bonus, utilise le code ANALYSE20 pour -20% sur l'analyse Anabolic !

Clique ici pour reprendre où tu en étais : ${window.location.origin}/audit-complet/questionnaire

À très vite,
Achzod`),I(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Relancer par email"]})})]})]})},s.id)})})]}),e.jsxs(U,{value:"promo",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Gestion des codes promo"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Créez et gérez les codes de réduction"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",onClick:R,disabled:x,children:[e.jsx(z,{className:`w-4 h-4 mr-2 ${x?"animate-spin":""}`}),"Actualiser"]}),e.jsxs(l,{onClick:()=>M(!0),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Nouveau code"]})]})]}),x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-primary"})}):re.length===0?e.jsx(c,{children:e.jsxs(d,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Aucun code promo"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Créez votre premier code promo"}),e.jsxs(l,{className:"mt-4",onClick:()=>M(!0),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Créer un code"]})]})}):e.jsx("div",{className:"space-y-4",children:re.map((s,t)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:e.jsx(c,{className:s.isActive?"":"opacity-60",children:e.jsx(w,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"text-xl font-mono",children:s.code}),e.jsx(u,{variant:s.isActive?"default":"secondary",children:s.isActive?"Actif":"Inactif"}),e.jsxs(u,{variant:"outline",className:"text-lg font-bold",children:["-",s.discountPercent,"%"]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4"}),"Valide pour: ",s.validFor==="ALL"?"Tous":s.validFor]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4"}),"Utilisations: ",s.currentUses,s.maxUses?`/${s.maxUses}`:""]}),s.expiresAt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),"Expire: ",new Date(s.expiresAt).toLocaleDateString("fr-FR")]})]})]}),e.jsx(l,{variant:s.isActive?"outline":"default",size:"sm",onClick:()=>Ce(s),children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Désactiver"]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Activer"]})})]})})})},s.id))})]})]})]}),we&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(c,{className:"max-w-lg w-full",children:[e.jsx(w,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Nouveau code promo"]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Code *"}),e.jsx(A,{value:n.code,onChange:s=>g({...n,code:s.target.value.toUpperCase()}),placeholder:"Ex: PROMO2024",className:"font-mono"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Réduction (%) *"}),e.jsx(A,{type:"number",min:"1",max:"100",value:n.discountPercent,onChange:s=>g({...n,discountPercent:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Valide pour"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:n.validFor,onChange:s=>g({...n,validFor:s.target.value}),children:[e.jsx("option",{value:"ALL",children:"Tous les audits"}),e.jsx("option",{value:"PREMIUM",children:"Anabolic uniquement"}),e.jsx("option",{value:"ELITE",children:"Ultimate uniquement"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Description"}),e.jsx(A,{value:n.description,onChange:s=>g({...n,description:s.target.value}),placeholder:"Description du code promo"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Utilisations max"}),e.jsx(A,{type:"number",min:"1",value:n.maxUses,onChange:s=>g({...n,maxUses:s.target.value}),placeholder:"Illimité"})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Date d'expiration"}),e.jsx(A,{type:"date",value:n.expiresAt,onChange:s=>g({...n,expiresAt:s.target.value})})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx(l,{variant:"outline",onClick:()=>{M(!1),g({code:"",discountPercent:20,description:"",validFor:"ALL",maxUses:"",expiresAt:""})},children:"Annuler"}),e.jsxs(l,{onClick:Ee,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Créer le code"]})]})]})]})}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(c,{className:"max-w-2xl w-full",children:[e.jsx(w,{children:e.jsx(T,{children:"Envoyer un CTA"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Objet *"}),e.jsx(A,{value:V,onChange:s=>O(s.target.value),placeholder:"Objet du message"})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Message *"}),e.jsx(Xe,{value:X,onChange:s=>_(s.target.value),placeholder:"Contenu du message...",rows:8})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:()=>I(!1),children:"Annuler"}),e.jsxs(l,{onClick:Re,children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Envoyer"]})]})]})]})}),e.jsx(Be,{})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md px-4",children:e.jsxs(c,{children:[e.jsxs(w,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10",children:e.jsx(Le,{className:"h-8 w-8 text-primary"})}),e.jsx(T,{className:"text-2xl",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Accès réservé"})]}),e.jsx(d,{children:e.jsxs("form",{onSubmit:Ae,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"password",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(A,{id:"password",type:"password",placeholder:"Entrez le mot de passe",value:ae,onChange:s=>fe(s.target.value),className:`pl-10 ${ie?"border-red-500":""}`})]}),ie&&e.jsx("p",{className:"text-sm text-red-500",children:"Mot de passe incorrect"})]}),e.jsx(l,{type:"submit",className:"w-full",children:"Accéder au dashboard"})]})})]})})})}export{ls as default};
