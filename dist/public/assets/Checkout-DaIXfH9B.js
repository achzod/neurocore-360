import{u as G,r as n,aF as H,j as e,B as p,aR as M,l as E,aS as J,aT as Z,aO as Q,aU as Y,aV as L,aW as K,aX as ee,aC as se,aY as ae}from"./vendor-C1l_5e97.js";import{B as j}from"./button-DpFebx5z.js";import{C as N,a as te,b as ie,c as v}from"./card-CFv6635F.js";import{B as y}from"./badge-wSxm0MMJ.js";import{u as re,H as ne,a as I}from"./index-Cv9frRJP.js";import{I as oe}from"./input-Ci_LweTY.js";const b=[{id:"gratuit",name:"Discovery Scan",subtitle:"Diagnostic gratuit et rapide",priceLabel:"0€",features:["66 questions essentielles","Dashboard interactif","Scores des domaines clés","Radar de performance"],lockedFeatures:["Rapport complet 16 sections","Protocoles 90 jours","Stack suppléments","Wearables & analyse photo"]},{id:"anabolic",name:"Anabolic Bioscan",subtitle:"Audit complet sur-mesure",priceLabel:"59€",popular:!0,coachingNote:"Le meilleur équilibre profondeur / prix",features:["137 questions approfondies","Rapport 16 sections","Axes cliniques + hormones","Protocoles 90 jours détaillés","Stack suppléments personnalisé"],lockedFeatures:["Wearables & analyse photo","Nutrition timing avancé","HRV & performance cardio"]},{id:"ultimate",name:"Ultimate Scan",subtitle:"Le scan le plus complet",priceLabel:"79€",features:["183 questions ultra-détaillées","Rapport 18 sections","Wearables (Oura, Whoop, Garmin...)","Analyse photo posturale","Nutrition timing + cardio avancé","HRV & performance"],lockedFeatures:[]}],_={gratuit:"GRATUIT",anabolic:"PREMIUM",ultimate:"ELITE"},q=l=>{if(!l)return null;const t=l.toLowerCase();return t==="gratuit"||t==="discovery"||t==="free"?"gratuit":t==="anabolic"||t==="premium"||t==="essential"?"anabolic":t==="ultimate"||t==="elite"?"ultimate":null};function xe(){var R;const[,l]=G(),{toast:t}=re(),[a,C]=n.useState(null),[u,A]=n.useState(null),[S,F]=n.useState(""),[w,D]=n.useState({}),[d,P]=n.useState(""),[k,T]=n.useState(!1),[r,x]=n.useState(null),[h,c]=n.useState(null);n.useEffect(()=>{const s=localStorage.getItem("neurocore_email"),i=localStorage.getItem("neurocore_responses"),o=new URLSearchParams(window.location.search),V=q(o.get("plan")),X=q(localStorage.getItem("neurocore_plan")),m=V??X;if(m&&(localStorage.setItem("neurocore_plan",m),C(m),A(m)),!s||!i){const z=m?`?plan=${m}`:"";l(`/audit-complet/questionnaire${z}`);return}F(s),D(JSON.parse(i))},[l]);const f=async()=>{if(d.trim()){T(!0),c(null);try{const i=await(await fetch("/api/promo-codes/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d.trim(),auditType:a?_[a]:"ALL"})})).json();i.valid?(x({code:d.trim().toUpperCase(),discount:i.discount}),c(null),t({title:"Code promo appliqué !",description:`-${i.discount}% de réduction sur ton analyse`})):(x(null),c(i.error||"Code invalide"))}catch{c("Erreur de validation")}finally{T(!1)}}},U=()=>{x(null),P(""),c(null)};n.useEffect(()=>{r&&a&&f()},[a]);const O={anabolic:"price_1SisNBRDE5WXnLZXF6QIJuh4",ultimate:"price_1SisNCRDE5WXnLZXTk4obahF"},g=H({mutationFn:async s=>{const i=_[s];return s==="gratuit"?I("POST","/api/audit/create",{email:S,type:i,responses:w}):(await I("POST","/api/stripe/create-checkout-session",{priceId:O[s],email:S,planType:i,responses:w,promoCode:(r==null?void 0:r.code)||null})).json()},onSuccess:s=>{a==="gratuit"?(t({title:"Audit créé avec succès !",description:"Tu vas recevoir un email avec tes résultats."}),localStorage.removeItem("neurocore_responses"),localStorage.removeItem("neurocore_section"),l("/auth/check-email")):s!=null&&s.url&&(window.location.href=s.url)},onError:()=>{t({title:"Erreur",description:"Une erreur est survenue. Réessaie.",variant:"destructive"})}}),B=s=>{u&&s!==u||C(s)},W=()=>{a&&g.mutate(a)},$=u?b.filter(s=>s.id===u):b;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ne,{}),e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-12",children:[e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center",children:[e.jsx(y,{variant:"secondary",className:"mb-4",children:"Questionnaire complété"}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight sm:text-4xl",children:"Choisis ton niveau d'analyse"}),e.jsx("p",{className:"mx-auto mt-4 max-w-xl text-lg text-muted-foreground",children:"Felicitations ! Tu as termine le questionnaire. Selectionne maintenant le niveau d'analyse qui te convient."})]}),e.jsx("div",{className:"mt-12 grid gap-6 lg:grid-cols-2 items-stretch max-w-4xl mx-auto",children:$.map((s,i)=>e.jsxs(p.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:i*.1},className:"relative flex",children:[s.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 z-10 -translate-x-1/2",children:e.jsxs(y,{className:"gap-1 px-3 py-1",children:[e.jsx(M,{className:"h-3 w-3"}),"Le + populaire"]})}),e.jsxs(N,{className:`h-full cursor-pointer transition-all ${a===s.id?"border-primary ring-2 ring-primary":s.popular?"border-primary/50":""}`,onClick:()=>B(s.id),"data-testid":`card-plan-${s.id}`,children:[e.jsxs(te,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{className:"text-xl",children:s.name}),a===s.id&&e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-primary",children:e.jsx(E,{className:"h-4 w-4 text-primary-foreground"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.subtitle})]}),e.jsxs(v,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"text-4xl font-bold",children:s.priceLabel})}),"coachingNote"in s&&s.coachingNote&&e.jsx("div",{className:"mb-6 rounded-md bg-primary/10 px-3 py-2",children:e.jsx("p",{className:"text-xs font-medium text-primary",children:s.coachingNote})}),e.jsxs("ul",{className:"space-y-3",children:[s.features.map(o=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"mt-0.5 h-4 w-4 shrink-0 text-primary"}),e.jsx("span",{className:"text-sm",children:o})]},o)),s.lockedFeatures.map(o=>e.jsxs("li",{className:"flex items-start gap-3 text-muted-foreground",children:[e.jsx(J,{className:"mt-0.5 h-4 w-4 shrink-0"}),e.jsx("span",{className:"text-sm",children:o})]},o))]})]})]})]},s.id))}),a&&a!=="gratuit"&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},className:"mt-8 max-w-md mx-auto",children:e.jsx(N,{children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Z,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Code promo"})]}),r?e.jsxs("div",{className:"flex items-center justify-between rounded-md bg-green-500/10 border border-green-500/30 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-mono font-medium",children:r.code}),e.jsxs(y,{variant:"secondary",className:"ml-2",children:["-",r.discount,"%"]})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:U,className:"text-muted-foreground hover:text-foreground",children:e.jsx(Y,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(oe,{placeholder:"Entre ton code promo",value:d,onChange:s=>{P(s.target.value.toUpperCase()),c(null)},onKeyDown:s=>s.key==="Enter"&&f(),className:`font-mono ${h?"border-red-500":""}`}),h&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:h})]}),e.jsx(j,{variant:"secondary",onClick:f,disabled:k||!d.trim(),children:k?e.jsx(L,{className:"h-4 w-4 animate-spin"}):"Appliquer"})]})]})})}),e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"mt-8",children:e.jsx(N,{className:"bg-muted/30",children:e.jsxs(v,{className:"flex flex-col items-center gap-6 p-8 sm:flex-row sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:a?`Tu as sélectionné : ${(R=b.find(s=>s.id===a))==null?void 0:R.name}`:"Sélectionne un plan pour continuer"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:a==="gratuit"?"Tu recevras un email avec un lien vers ton rapport de base.":a?"Tu seras redirigé vers le paiement sécurisé.":"Clique sur l'une des offres ci-dessus."}),r&&a&&a!=="gratuit"&&e.jsxs("p",{className:"mt-2 text-sm font-medium text-green-500",children:["Code promo ",r.code," appliqué : -",r.discount,"% de réduction"]})]}),e.jsx(j,{size:"lg",disabled:!a||g.isPending,onClick:W,className:"w-full sm:w-auto","data-testid":"button-confirm-plan",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Création..."]}):e.jsxs(e.Fragment,{children:["Confirmer",e.jsx(K,{className:"ml-2 h-4 w-4"})]})})]})})}),e.jsxs("div",{className:"mt-8 flex flex-wrap items-center justify-center gap-6 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Paiement sécurisé"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Résultats instantanés"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Garantie satisfait"]})]})]})]})}export{xe as default};
