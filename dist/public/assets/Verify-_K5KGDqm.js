import{u as p,bG as j,r as n,j as e,B as r,aV as g,aO as y,aU as N,s as v}from"./vendor-C1l_5e97.js";import{C as b,a as C,b as c,c as S}from"./card-D1XCqY91.js";import{B as k}from"./button-BtttnI-5.js";import{H as w}from"./index-DvBPY4Ge.js";function E(){const[,i]=p(),l=j(),[t,a]=n.useState("loading"),[h,f]=n.useState(null);return n.useEffect(()=>{const o=new URLSearchParams(l),m=o.get("token"),d=o.get("email");if(!m||!d){a("error");return}fetch("/api/auth/verify-magic-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:m,email:d})}).then(s=>s.json()).then(s=>{var u;if(s.success&&((u=s.me)!=null&&u.email)&&s.token){f(s.me.email),localStorage.setItem("neurocore_email",s.me.email),localStorage.setItem("apexlabs_token",s.token),a("success");const x=localStorage.getItem("apexlabs_post_login_redirect")||"";x?(localStorage.removeItem("apexlabs_post_login_redirect"),i(x)):i("/dashboard")}else a("error")}).catch(()=>{a("error")})},[l,i]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(w,{}),e.jsx("div",{className:"mx-auto max-w-md px-4 py-20",children:e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(b,{children:[e.jsxs(C,{className:"text-center",children:[t==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(r.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-primary/10",children:e.jsx(g,{className:"h-10 w-10 text-primary"})}),e.jsx(c,{className:"text-2xl",children:"Verification en cours..."}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Nous confirmons ton acces"})]}),t==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-primary/10",children:e.jsx(y,{className:"h-10 w-10 text-primary"})}),e.jsx(c,{className:"text-2xl",children:"Acces confirme"}),e.jsxs("p",{className:"mt-2 text-muted-foreground",children:["Bienvenue ",h,". Redirection vers ton espace..."]})]}),t==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(N,{className:"h-10 w-10 text-destructive"})}),e.jsx(c,{className:"text-2xl",children:"Lien invalide"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Ce lien a expire ou est invalide. Demande un nouveau lien."})]})]}),t==="error"&&e.jsx(S,{children:e.jsx(v,{href:"/auth/login",children:e.jsx(k,{className:"w-full","data-testid":"button-retry-login",children:"Demander un nouveau lien"})})})]})})})]})}export{E as default};
